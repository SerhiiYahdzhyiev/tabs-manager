(function(){"use strict";var t;(function(t){t["WINDOW"]="window";t["WORKER"]="worker";t["INVALID"]="invalid"})(t||(t={}));function e(){const e=String(globalThis);if(e.match(/worker/gi)){return t.WORKER}else if(e.match(/window/gi)){return t.WINDOW}console.warn("Environment detection failed!");return t.INVALID}function i(e){switch(e){case t.WINDOW:return!!(typeof browser!=="undefined"&&browser.tabs||globalThis.chrome&&chrome.tabs);case t.WORKER:return!!(chrome&&chrome.tabs||browser&&browser.tabs)}return false}function s(){if(typeof chrome!=="undefined"){return chrome.tabs}return browser===null||browser===void 0?void 0:browser.tabs}function r(){if(typeof chrome!=="undefined"){return chrome.runtime}return browser.runtime}function n(){var t;if(!((t=r().getManifest().permissions)===null||t===void 0?void 0:t.includes("scripting"))){console.warn("This runtime doesn't have required optional permission!");return null}if(typeof chrome!=="undefined"){return chrome.scripting}return browser.scripting}function o(){var t;if(!((t=r().getManifest().permissions)===null||t===void 0?void 0:t.includes("debugger"))){console.warn("This runtime doesn't have required optional permission!");return null}if(typeof chrome!=="undefined"){return chrome.debugger}return browser.debugger}var a=undefined&&undefined.__awaiter||function(t,e,i,s){function r(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,n){function o(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s["throw"](t))}catch(t){n(t)}}function d(t){t.done?i(t.value):r(t.value).then(o,a)}d((s=s.apply(t,e||[])).next())}))};function d(t){if(typeof t!=="string"||!t.trim())throw new Error("Invalid input: "+t);const e=t.split("").toReversed()[0];if(e==="/"){return t}return t+"/"}function h(t,e,i){if(!t||!(t instanceof Map))throw Error("Invalid input: "+t);if(!i){t.delete(e);return}t.set(e,i)}const u=(t,e,i)=>{if(!t||!(t instanceof Map))throw Error("Invalid input: "+t);if(!i){console.warn("Invalid value",i);return}if(!t.has(e)){t.set(e,[i]);return}const s=t.get(e);if(s.includes(i)){const r=s.filter((t=>t!==i));if(!r.length){t.delete(e);return}t.set(e,r);return}const r=[...s,i];t.set(e,r)};function l(t){return(...e)=>a(this,void 0,void 0,(function*(){let i=null;let s;try{s=yield t(...e)}catch(t){i={message:String(t),stack:(new Error).stack}}finally{return[i,s]}}))}function c(t){return a(this,void 0,void 0,(function*(){return new Promise((e=>setTimeout(e,t)))}))}var _=()=>{const t=Array.from(document.querySelectorAll("form"));t.forEach((t=>t.reset()));const e=Array.from(document.querySelectorAll("input[type='text']"));e.concat(Array.from(document.querySelectorAll("input[type='email']")));e.concat(Array.from(document.querySelectorAll("input[type='password']")));e.forEach((t=>t.value=""));const i=Array.from(document.querySelectorAll("[contenteditable='true'][role='textbox']"));i.forEach((t=>t.textContent=""))};var v=undefined&&undefined.__awaiter||function(t,e,i,s){function r(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,n){function o(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s["throw"](t))}catch(t){n(t)}}function d(t){t.done?i(t.value):r(t.value).then(o,a)}d((s=s.apply(t,e||[])).next())}))};class Tab{_withRemoved(t){return(...e)=>{if(this._removed){console.warn("Cannot use operation on closed tab!");return}return t(...e)}}constructor(t){var e;this.active=false;this.id=-1;this.index=-1;this.windowId=-1;this.url="";this.pendingUrl="";this.lastAccessed=Date.now();this._removed=false;Object.assign(this,t);Object.assign(this,{[Symbol.toStringTag]:`Tab.${((e=this.urlObj)===null||e===void 0?void 0:e.host)||"broken"}`});this.createdAt=Date.now();this.connect=this._withRemoved(this._connect.bind(this));this.clearAllInputs=this._withRemoved(l(this._clearAllInputs.bind(this)));this.discard=this._withRemoved(l(this._discard.bind(this)));this.duplicate=this._withRemoved(l(this._duplicate.bind(this)));this.goBack=this._withRemoved(l(this._goBack.bind(this)));this.goForward=this._withRemoved(l(this._goForward.bind(this)));this.getLanguage=this._withRemoved(l(this._language.bind(this)));this.getScreenshot=this._withRemoved(l(this._screenshot.bind(this)));this.move=this._withRemoved(l(this._move.bind(this)));this.reload=this._withRemoved(l(this._reload.bind(this)));this.remove=this._withRemoved(this._withRemoved(l(this._remove.bind(this))));this.update=this._withRemoved(l(this._update.bind(this)));this.focus=this._withRemoved(l(this.focus.bind(this)));this.forceClose=this._withRemoved(l(this.forceClose.bind(this)))}_discard(){return v(this,void 0,void 0,(function*(){const t=yield s().discard(this.id);_tabs.discard(this.id,t.id);Object.assign(this,t);return this}))}focus(){return v(this,void 0,void 0,(function*(){yield this._update({active:true});return}))}_screenshot(t){return v(this,void 0,void 0,(function*(){yield this.focus();return yield s().captureVisibleTab(this.windowId,t)}))}_move(t){return v(this,void 0,void 0,(function*(){const e=yield s().move(this.id,t);Object.assign(this,e);return this}))}_reload(t){return v(this,void 0,void 0,(function*(){yield s().reload(this.id,t)}))}_goForward(){return v(this,void 0,void 0,(function*(){yield s().goForward(this.id)}))}_goBack(){return v(this,void 0,void 0,(function*(){yield s().goBack(this.id)}))}_duplicate(){return v(this,void 0,void 0,(function*(){yield s().duplicate(this.id)}))}_language(){return v(this,void 0,void 0,(function*(){return yield s().detectLanguage(this.id)}))}_connect(t){return s().connect(this.id,t)}_remove(){return v(this,void 0,void 0,(function*(){this._removed=true;yield s().remove(this.id)}))}_update(t){return v(this,void 0,void 0,(function*(){yield s().update(this.id,t);Object.assign(this,t);return this}))}_clearAllInputs(){return v(this,void 0,void 0,(function*(){const t=n();if(!t)throw new Error("Scripting is not permitted or/and available!");yield t.executeScript({target:{tabId:this.id},func:_})}))}forceClose(){return v(this,void 0,void 0,(function*(){const t=o();if(!t)throw new Error("Debugger is not permitted or/and available!");try{yield t.attach({tabId:this.id},"1.3")}catch(t){console.warn(t)}yield t.sendCommand({tabId:this.id},"Page.navigate",{url:"about:blank"});yield t.detach({tabId:this.id});yield this.remove()}))}get urlObj(){const t=this.url||this.pendingUrl;if(!t)return null;return new URL(t)}get host(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.host)||""}get hostname(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.hostname)||""}get origin(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.origin)||""}get href(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.href)||""}get protocol(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.protocol)||""}get username(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.username)||""}get hash(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.hash)||""}get password(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.password)||""}get pathname(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.pathname)||""}get search(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.search)||""}get searchParams(){var t;return((t=this.urlObj)===null||t===void 0?void 0:t.searchParams)||null}get port(){var t;const e=parseInt(((t=this.urlObj)===null||t===void 0?void 0:t.port)||"");if(e)return e;if(this.protocol.includes("https"))return 443;if(this.protocol.includes("http"))return 80;if(this.protocol.includes("ftp"))return 21;if(this.protocol.includes("sftp")||this.protocol.includes("ssh"))return 22;return 0}get uptime(){return Date.now()-this.createdAt}get msFromLastAccessed(){return Date.now()-Math.round(this.lastAccessed)}}class TabMaps{constructor(){this._maps=new Map;this._updaters=new Map}_updateMap(t,e,i,s){e(t,i,s)}updateMap(t,e,i){if(!this._maps.has(t)){throw new Error("No map registered with name: "+t)}if(!this._updaters.has(t)){throw new Error("No updaters registered for map with name: "+t)}const s=this._maps.get(t);const r=this._updaters.get(t);this._updateMap(s,r,e,i)}registerMap(t,e){if(this._maps.has(t)){throw new Error("Duplicate map name: "+t)}this._maps.set(t,e)}registerUpdater(t,e){if(this._updaters.has(t)){throw new Error("Duplicate updater for: "+t)}this._updaters.set(t,e)}}var f=undefined&&undefined.__awaiter||function(t,e,i,s){function r(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,n){function o(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s["throw"](t))}catch(t){n(t)}}function d(t){t.done?i(t.value):r(t.value).then(o,a)}d((s=s.apply(t,e||[])).next())}))};class Tabs{_assertTabId(t){if(!t.id){return false}return true}_assertTabUrl(t){if(!t.url&&!t.pendingUrl){return false}return true}log(...t){if(this.__debug__)console.log(...t)}getTabById(t){return this._idToTab.get(t)||null}getTabsByUrl(t){const e=this._urlToIds.get(d(t));if(e&&e.length){const t=[];for(const i of e){t.push(this.getTabById(i))}return t}return[]}getIdsBy(t){return this._urlToIds.get(t)||[]}get(t){if(typeof t==="number"){return this.getTabById(t)}if(typeof t==="string"){let e=null;if(!isNaN(+t)&&+t>0){e=this.getTabById(+t)}if(!e)e=this.getTabsByUrl(t);return e}return null}hasId(t){return this._idToTab.has(t)}hasUrl(t){return this._urlToIds.has(d(t))}has(t){if(typeof t==="number"){return this._idToTab.has(t)}if(typeof t==="string"){let e=false;if(!isNaN(+t)&&+t>0){e=this._idToTab.has(+t)}const i=this._urlToIds.has(d(t));return e||i}return false}activatedListener(t){return f(this,void 0,void 0,(function*(){this.log("Activating...");if(this._activeId&&this._activeId!==t.tabId){const t=this.get(this._activeId);if(t){this._tabs[t.index].active=t.active=false}}this._activeId=t.tabId;const e=yield chrome.windows.get(t.windowId);if(e.focused){const e=this.get(t.tabId);if(e)this._tabs[e.index].active=e.active=true}}))}mainListener(){for(const[t,e]of this._hostToIds.entries()){if(!e.length){this.log("Deleting ",t);this._hostToIds.delete(t)}}}discard(t,e){var i,s,r,n;const o=this._idToTab.get(t);this._idToTab.delete(t);this._idToTab.set(e,o);this.__maps__.updateMap("urlToIds",o.url,t);this.__maps__.updateMap("urlToIds",o.url,e);if((i=o.urlObj)===null||i===void 0?void 0:i.host)this.__maps__.updateMap("hostToIds",(s=o.urlObj)===null||s===void 0?void 0:s.host,t);if((r=o.urlObj)===null||r===void 0?void 0:r.host)this.__maps__.updateMap("hostToIds",(n=o.urlObj)===null||n===void 0?void 0:n.host,e)}constructor(){this.__debug__=false;this._activeId=0;this.__maps__=new TabMaps;this._urlToIds=new Map;this._idToTab=new Map;this._tabs=[];this._hostToIds=new Map;this.createListener=t=>{var e;this.log("Created!");const i=new Tab(t);this._tabs=[...this._tabs,i];if(!this._assertTabId(i)){console.warn("Skipping tab without id!");console.warn("This tab will not be saved in id->tab map!");console.dir(t);return}this._idToTab.set(t.id,i);if(!this._assertTabUrl(i)){console.warn("Skipping tab without both url and pendingUrl!");console.warn("This tab will not be saved in url->tab map!");return}const s=i.url||i.pendingUrl;this.__maps__.updateMap("urlToIds",s,i.id);const r=(e=i.urlObj)===null||e===void 0?void 0:e.host;if(r){this.__maps__.updateMap("hostToIds",r,i.id)}else{console.warn("Failed to get host on wrapped tab!")}};this.updateListener=(t,e)=>{var i,s;this.log("Updated!");this.log(t,e);const r="discarded"in e&&e.discarded===true;if(r)return;const n="url"in e||"pendingUrl"in e;if(!this.hasId(t)){console.warn(t);throw Error("Failed to find updated tab by id!")}const o=this.getTabById(t);if(n){const t=o.url||o.pendingUrl;this.__maps__.updateMap("urlToIds",t,o.id);const r=(i=o.urlObj)===null||i===void 0?void 0:i.host;const n=new URL((s=e.url)!==null&&s!==void 0?s:"").host;if(n&&n!==r){if(r)this.__maps__.updateMap("hostToIds",r,o.id);this.__maps__.updateMap("hostToIds",n,o.id)}}Object.assign(o,e);if(n&&this._assertTabUrl(o)){const t=o.url||o.pendingUrl;this.__maps__.updateMap("urlToIds",t,o.id)}};this.removeListener=t=>{var e;this.log("Removed!");const i=this.getTabById(t);const s=(e=i===null||i===void 0?void 0:i.urlObj)===null||e===void 0?void 0:e.host;if(s&&this._hostToIds.has(s)){this.__maps__.updateMap("hostToIds",s,t)}else{console.warn("Failed to get host removed tab!")}this._tabs=this._tabs.filter((e=>e.id!==t));this._idToTab.delete(t);const r=i.url||i.pendingUrl;if(this._urlToIds.has(r)){this.__maps__.updateMap("urlToIds",r,t)}};this.__maps__.registerMap("idToTab",this._idToTab);this.__maps__.registerMap("urlToIds",this._urlToIds);this.__maps__.registerMap("hostToIds",this._hostToIds);this.__maps__.registerUpdater("idToTab",h);this.__maps__.registerUpdater("urlToIds",u);this.__maps__.registerUpdater("hostToIds",u);const t=s();t.onActivated.addListener(this.activatedListener.bind(this));t.onUpdated.addListener(this.mainListener.bind(this));t.onRemoved.addListener(this.mainListener.bind(this));t.onCreated.addListener(this.createListener.bind(this));t.onUpdated.addListener(this.updateListener.bind(this));t.onRemoved.addListener(this.removeListener.bind(this));t.query({},(t=>{this._tabs=t.map((t=>new Tab(t)));this._tabs.forEach((t=>{if(t.active){this._activeId=t.id}this._idToTab.set(t.id,t);const e=t.url||t.pendingUrl;const i=new URL(e).host;if(i){this.__maps__.updateMap("hostToIds",i,t.id)}this.__maps__.updateMap("urlToIds",e,t.id)}))}));Object.assign(this,{[Symbol.toStringTag]:`Tabs`})}get tabs(){return this._tabs}get last(){return this._tabs[this._tabs.length-1]}get first(){return this._tabs[0]}get activeId(){if(this._activeId){return this._activeId}return 0}}Tabs.__mapNames__=new Set(["idToTab","urlToIds","hostToTab"]);var b=undefined&&undefined.__awaiter||function(t,e,i,s){function r(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,n){function o(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s["throw"](t))}catch(t){n(t)}}function d(t){t.done?i(t.value):r(t.value).then(o,a)}d((s=s.apply(t,e||[])).next())}))};class TabsManager{static get version(){return this.__version__}get version(){return TabsManager.version}constructor(t){this._name="default";if(t===null||t===void 0?void 0:t.name){this._name=t.name;this.version=TabsManager.version;Object.setPrototypeOf(this,TabsManager.prototype)}const e=s();Object.assign(this,{create:(...t)=>b(this,void 0,void 0,(function*(){yield e.create(...t);yield c(200);return _tabs.tabs[_tabs.tabs.length-1]})),connect:e.connect,discard:t=>b(this,void 0,void 0,(function*(){const i=yield e.discard(t);const s=_tabs.getTabById(t);_tabs.discard(t,i.id);Object.assign(s,i);return s})),query:t=>b(this,void 0,void 0,(function*(){const i=yield e.query(t);if(i===null||i===void 0?void 0:i.length){for(let t=0;t<i.length;t++){i[t]=new Tab(i[t])}}return i})),remove:e.remove,reload:e.reload,update:(t,i)=>b(this,void 0,void 0,(function*(){const s=yield e.update(t,i);yield c(200);return _tabs.get(s.id)}))});Object.assign(this,{[Symbol.toStringTag]:`TabsManager ${this._name}`})}static withTabs(t){return(...e)=>t(_tabs.tabs,...e)}getActive(){if(_tabs.activeId){return _tabs.get(_tabs.activeId)}return null}getAll(){return _tabs.tabs}get(t){return _tabs.get(t)}has(t){return _tabs.has(t)}focus(t){t.focus()}get tabs(){return _tabs.tabs}get first(){return _tabs.first}get last(){return _tabs.last}}TabsManager.__version__="0.1.0";const p=["tabs","activeTab"];(()=>{if(!i(e())){console.warn("This environment is not suitable for TabsManager!");return 1}const t=r().getManifest()["permissions"];const s=p.every((e=>t===null||t===void 0?void 0:t.includes(e)));if(!s){console.warn("This extension does not have a required permissions for TabsManager!");return 1}Object.assign(globalThis,{envType:e()});Object.assign(globalThis,{_tabs:new Tabs});Object.assign(globalThis,{TabsManager:TabsManager})})()})();
